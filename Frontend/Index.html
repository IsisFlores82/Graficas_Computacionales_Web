<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dish Dash</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/Frontend/Index.css">

</head>
<!--NOTA DEL AUTOR: La actual imagen de fondo solo es place holder para que en un futuro esta bien el render, es solo temporal pq mi blender
                    no me esta cargando bien los materiales y texturas e.e-->

<body>

  <audio id="background-music" autoplay loop>
    <source src="../Assets/Kitchen_Chaos_1.mp3" type="audio/mp3">
    Tu navegador no soporta la reproducción de audio.
  </audio>

  <video autoplay muted loop id="background-video">
    <source src="../Assets/video loop solo autos.mp4" type="video/mp4">
    Tu navegador no soporta la reproducción de video.
  </video>
  <button id="unmute-btn">Activar sonido</button>

  <div class="d-flex flex-column w-100 vh-100 align-items-center justify-content-center">
    <div class="image-text-container">
      <h1 class="parpadea principal-text">Presiona ENTER para continuar!</h1>
    </div>



    <!-- Modal -->
    <div class="modal fade" id="StartModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-body-secondary">
          <div class="modal-header">
            <img src="/Frontend/logo DD font.png" class="logo-small" alt="DISH DASH!">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body d-flex flex-column align-items-center justify-content-center">
            <button id="BtnComenzar" class="btn btn-secondary btn-orange"> Comenzar</button>
            <br>
            <button id="BtnLeaderboard" class="btn btn-secondary btn-orange"> Leaderboard</button>
            <br>
            <button id="BtnSettings" class="btn btn-secondary btn-orange"> Settings</button>
            <br>
            <button id="loginWithFacebook" class="btn btn-primary">
              <i class="fab fa-facebook"></i> Inicia sesión con Facebook
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Crear o Unirse a una Partida -->
    <div class="modal fade" id="GameMenuModal" tabindex="-1" aria-labelledby="GameMenuLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-body-secondary">
          <div class="modal-header">
            <h5 class="modal-title" id="GameMenuLabel">Selecciona una Opción</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body d-flex flex-column align-items-center justify-content-center">
            <!-- Campo para ingresar el nombre de usuario -->
            <div class="form-group w-100 d-flex flex-column align-items-center">
              <label for="usernameInput" class="form-label text-center">Ingresa tu nombre de usuario</label>
              <input type="text" id="usernameInput" class="form-control w-50 text-center"
                placeholder="Tu nombre de usuario" required>
              <small class="text-danger d-none" id="usernameError">Por favor, ingresa un nombre de usuario.</small>
            </div>

            <!-- Botones para Crear o Unirse a una Partida -->
            <button id="Coop11" class="btn btn-secondary btn-orange m-2">Cooperativo Facil</button>
            <button id="Coop22" class="btn btn-secondary btn-orange m-2">Cooperativo Dificil</button>
            <button id="VS31" class="btn btn-secondary btn-orange m-2">Multijugador Facil</button>
            <button id="VS32" class="btn btn-secondary btn-orange m-2">Multijugador Dificil</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para Crear Partida
<div class="modal fade" id="CreateGameModal" tabindex="-1" aria-labelledby="CreateGameLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-body-secondary">
      <div class="modal-header">
        <h5 class="modal-title" id="CreateGameLabel">Crear Partida</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <div class="mb-3">
          <label for="mapSelect" class="form-label">Selecciona un Mapa</label>
          <select id="mapSelect" class="form-select" required>
            <option value="" disabled selected>Selecciona un mapa</option>
            <option value="1">Mapa 1</option>
            <option value="2">Mapa 2</option>
          </select>
        </div>

        
        <div class="mb-3">
          <label for="difficultySelect" class="form-label">Selecciona la Dificultad</label>
          <select id="difficultySelect" class="form-select" required>
            <option value="" disabled selected>Selecciona la dificultad</option>
            <option value="1">Fácil</option>
            <option value="2">Difícil</option>
          </select>
        </div>

        
        <div class="mb-3">
          <label class="form-label">Jugadores en la Sala</label>
          <ul id="playerList" class="list-group mb-3">
            
          </ul>
        </div>

        
         <a href="/game.html" id="startGameButton" class="btn btn-secondary btn-orange w-100"> Empezar Partida </a>
        
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="JoinGameModal" tabindex="-1" aria-labelledby="JoinGameLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-body-secondary">
      <div class="modal-header">
        <h5 class="modal-title" id="JoinGameLabel">Unirse a una Partida</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <div class="mb-3">
          <label class="form-label">Selecciona una Partida</label>
          <ul id="availableGamesList" class="list-group mb-3">
            <li class="list-group-item" data-game="game1">Partida de Nevi</li>
            <li class="list-group-item" data-game="game2">Partida de Imsis</li>
            <li class="list-group-item" data-game="game3">Partida de Ryneh</li>
          </ul>
        </div>

       
        <button id="joinGameButton" class="btn btn-secondary btn-orange w-100" disabled>Unirse</button>
      </div>
    </div>
  </div>
</div> -->


    <!-- Leaderboard Modal -->
    <div class="modal fade" id="LeaderboardModal" tabindex="-1" aria-labelledby="LeaderboardModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-body-secondary">
          <div class="modal-header">
            <h5 class="modal-title" id="LeaderboardModalLabel">Leaderboard</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <table class="table table-striped table-bordered text-center">
              <thead>
                <tr>
                 <th scope="col">Rank</th>
                 <th scope="col">Jugadores</th>
                 <th scope="col">Puntuacion</th>
               </tr>
             </thead>
             <tbody id="leaderboard-body">
              <!-- Los datos se llenarán dinámicamente aquí -->
            </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Modal para Settings -->
  <div class="modal fade" id="Settings" tabindex="-1" aria-labelledby="SettingsMenu" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-body-secondary">
        <div class="modal-header">
          <h5 class="modal-title" id="GameMenuLabel">Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body d-flex flex-column align-items-center justify-content-center">
          <!-- Configuraciones -->
          <div class="d-flex align-items-center">
            <label for="volume" class="form-label me-3" id="vg">Volumen General:</label>
            <!-- Barra de volumen -->
            <input type="range" class="form-range volume-slider" id="volumegame" min="0" max="100" value="50">
            <span id="volumeValue" class="volume-value">50%</span>
          </div>

          <div class="d-flex align-items-center">
            <label for="volume" class="form-label me-3" id="vmsc">Volumen Música:</label>
            <!-- Barra de volumen -->
            <input type="range" class="form-range volume-slider" id="volumemusic" min="0" max="100" value="50">
            <span id="volumeValue2" class="volume-value">50%</span>
          </div>

          <div class="d-flex align-items-center">
            <label for="volume" class="form-label me-3" id="vsfx">Volumen SFX:</label>
            <!-- Barra de volumen -->
            <input type="range" class="form-range volume-slider" id="volumesfx" min="0" max="100" value="50">
            <span id="volumeValue3" class="volume-value">50%</span>
          </div>
          <br>
        </div>
      </div>
    </div>
  </div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

  <script>
    // Configurar el SDK de Facebook
    window.fbAsyncInit = function () {
      FB.init({
        appId: '3789876967895990', // Reemplaza con tu App ID
        cookie: true,
        xfbml: true,
        version: 'v21.0'
      });

      // Verificar si el usuario ya está conectado
      FB.getLoginStatus(function (response) {
        statusChangeCallback(response);
      });
    };

    // Manejar el estado de inicio de sesión
    function statusChangeCallback(response) {
      if (response.status === 'connected') {
        console.log('Usuario conectado con Facebook');
        fetchUserInfo();
      } else {
        console.log('Usuario no conectado con Facebook');
      }
    }

    // Obtener información del usuario
    function fetchUserInfo() {
      FB.api('/me', { fields: 'name,email' }, function (response) {
        console.log('Información del usuario:', response);
        alert(`Bienvenido, ${response.name}!`);
        // Establece el nombre como el valor del input
        const usernameInput = document.getElementById('usernameInput');
        if (usernameInput) {
          usernameInput.value = response.name;
        } else {
          console.error("No se encontró el elemento con id 'usernameInput'.");
        }

      });
    }

  // Manejar el clic en el botón de inicio de sesión
  document.getElementById('loginWithFacebook').addEventListener('click', function() {
    FB.login(function(response) {
      if (response.authResponse) {
        console.log('Inicio de sesión exitoso');
        fetchUserInfo();
      } else {
        console.log('El usuario canceló el inicio de sesión o no autorizó la aplicación');
      }
    }, { scope: 'public_profile,email' });
  });
</script>
<script> 
// Función para obtener los datos de la API y actualizar la tabla
function fetchLeaderboardData() {
  // Realizar la solicitud a la API
  fetch('https://dishdashapi.mikuacademy.fun/api/puntuaciones')  // Asegúrate de usar la URL correcta
    .then(response => response.json())
    .then(data => {
      if (data.status === "success") {
        // Limpiar los datos previos en la tabla
        const leaderboardBody = document.getElementById('leaderboard-body');
        leaderboardBody.innerHTML = '';

        // Iterar sobre los datos y agregar las filas a la tabla
        data.data.forEach((player, index) => {
          // Crear una fila de la tabla
          const row = document.createElement('tr');

          // Crear la celda del rango
          const rankCell = document.createElement('th');
          rankCell.scope = 'row';
          rankCell.textContent = index + 1;  // Para que empiece desde 1
          row.appendChild(rankCell);

          // Crear la celda del nombre del jugador
          const nameCell = document.createElement('td');
          nameCell.textContent = player.name;
          row.appendChild(nameCell);

          // Crear la celda de los puntos
          const pointsCell = document.createElement('td');
          pointsCell.textContent = player.puntos;
          row.appendChild(pointsCell);

          // Agregar la fila al cuerpo de la tabla
          leaderboardBody.appendChild(row);
        });
      } else {
        console.error('Error al obtener los datos del leaderboard');
      }
    })
    .catch(error => {
      console.error('Error de conexión o de la API:', error);
    });
}

// Llamar a la función para cargar los datos cuando la página se carga
window.onload = fetchLeaderboardData;

    // Ejemplo: Enviar el nombre del jugador al servidor cuando inicien el juego
    document.getElementById("Coop11").addEventListener("click", () => {
      const playerName = document.getElementById("usernameInput").value;
      console.log("Nombre del jugador:", playerName);
      if (playerName) {
        localStorage.setItem("playerName", playerName);
        localStorage.setItem("Dificulty", 1);
        localStorage.setItem("Map", 1);
      }




    });
    // Ejemplo: Enviar el nombre del jugador al servidor cuando inicien el juego
    document.getElementById("Coop22").addEventListener("click", () => {
      const playerName = document.getElementById("usernameInput").value;
      console.log("Nombre del jugador:", playerName);
      if (playerName) {
        localStorage.setItem("playerName", playerName); // Guardar nombre en el navegador
        localStorage.setItem("Dificulty", 2);
        localStorage.setItem("Map", 2);
      }

    });
    // Ejemplo: Enviar el nombre del jugador al servidor cuando inicien el juego
    document.getElementById("VS31").addEventListener("click", () => {
      const playerName = document.getElementById("usernameInput").value;
      console.log("Nombre del jugador:", playerName);
      if (playerName) {
        localStorage.setItem("playerName", playerName);
        localStorage.setItem("Dificulty", 1);
        localStorage.setItem("Map", 3);
      }

    });
    // Ejemplo: Enviar el nombre del jugador al servidor cuando inicien el juego
    document.getElementById("VS32").addEventListener("click", () => {
      const playerName = document.getElementById("usernameInput").value;
      console.log("Nombre del jugador:", playerName);
      if (playerName) {
        localStorage.setItem("playerName", playerName); // Guardar nombre en el navegador
        localStorage.setItem("Dificulty", 2);
        localStorage.setItem("Map", 3);
      }

    });

    // Selecciona el video y el botón
const video = document.getElementById('background-video');
const unmuteBtn = document.getElementById('unmute-btn');

// Agrega un listener al botón para alternar el mute del video
unmuteBtn.addEventListener('click', () => {
  // Alternar el estado de mute
  video.muted = !video.muted;

  // Cambiar el texto del botón según el estado
  if (video.muted) {
    unmuteBtn.textContent = 'Activar sonido';
  } else {
    unmuteBtn.textContent = 'Silenciar sonido';
  }
});

// Selección de los sliders y spans de volumen
const generalSlider = document.getElementById('volumegame');
const musicSlider = document.getElementById('volumemusic');
const sfxSlider = document.getElementById('volumesfx');
const generalValue = document.getElementById('volumeValue');
const musicValue = document.getElementById('volumeValue2');
const sfxValue = document.getElementById('volumeValue3');

// Función para guardar los valores en localStorage y actualizar el texto
function updateVolume(type, value) {
  localStorage.setItem(type, value);
  if (type === 'generalVolume') generalValue.textContent = `${value}%`;
  if (type === 'musicVolume') musicValue.textContent = `${value}%`;
  if (type === 'sfxVolume') sfxValue.textContent = `${value}%`;
}

// Event listeners para los sliders
generalSlider.addEventListener('input', () => updateVolume('generalVolume', generalSlider.value));
musicSlider.addEventListener('input', () => updateVolume('musicVolume', musicSlider.value));
sfxSlider.addEventListener('input', () => updateVolume('sfxVolume', sfxSlider.value));

// Inicializar los valores de los sliders desde localStorage
window.addEventListener('DOMContentLoaded', () => {
  const generalVolume = localStorage.getItem('generalVolume') || '50';
  const musicVolume = localStorage.getItem('musicVolume') || '50';
  const sfxVolume = localStorage.getItem('sfxVolume') || '50';

  generalSlider.value = generalVolume;
  musicSlider.value = musicVolume;
  sfxSlider.value = sfxVolume;

  updateVolume('generalVolume', generalVolume);
  updateVolume('musicVolume', musicVolume);
  updateVolume('sfxVolume', sfxVolume);
});

  </script>
  <script src="/Frontend/Index.js"></script>
</body>

</html>